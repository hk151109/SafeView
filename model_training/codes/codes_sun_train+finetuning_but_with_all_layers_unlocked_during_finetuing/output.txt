(tf217) root@16DCEB107-GIS1:~/projects/tf217/codes_sun_train+finetuning_but_with_all_layers_unlocked_during_finetuing# python3.12 train.py
2025-04-22 05:52:03.916220: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-04-22 05:52:03.928229: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1745301123.942692   20390 cuda_dnn.cc:8579] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1745301123.947074   20390 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
W0000 00:00:1745301123.958183   20390 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1745301123.958232   20390 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1745301123.958236   20390 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
W0000 00:00:1745301123.958238   20390 computation_placer.cc:177] computation placer already registered. Please check linkage and avoid linking the same target more than once.
2025-04-22 05:52:03.961713: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
Step 1: Creating data generators...
Found 19600 files belonging to 5 classes.
I0000 00:00:1745301135.978586   20390 gpu_device.cc:2019] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 21746 MB memory:  -> device: 0, name: NVIDIA RTX A5000, pci bus id: 0000:65:00.0, compute capability: 8.6
Found 4200 files belonging to 5 classes.
Found 4200 files belonging to 5 classes.
Computing class weights to handle class imbalance...
2025-04-22 05:52:32.159079: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:452] ShuffleDatasetV3:23: Filling up shuffle buffer (this may take a while): 105 of 1000
2025-04-22 05:52:34.594186: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:482] Shuffle buffer filled.
2025-04-22 05:52:47.581791: I tensorflow/core/framework/local_rendezvous.cc:407] Local rendezvous is aborting with status: OUT_OF_RANGE: End of sequence
Class distribution: {np.int64(1): 3920, np.int64(2): 3920, np.int64(0): 3920, np.int64(4): 3920, np.int64(3): 3920}
Class weights: {np.int64(1): 1.0, np.int64(2): 1.0, np.int64(0): 1.0, np.int64(4): 1.0, np.int64(3): 1.0}
Step 2: Creating model architecture...
Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)                  ┃ Output Shape              ┃         Param # ┃ Connected to               ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ input_layer (InputLayer)      │ (None, 224, 224, 3)       │               0 │ -                          │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ rescaling (Rescaling)         │ (None, 224, 224, 3)       │               0 │ input_layer[0][0]          │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv (Conv2D)                 │ (None, 112, 112, 16)      │             432 │ rescaling[0][0]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv_bn (BatchNormalization)  │ (None, 112, 112, 16)      │              64 │ conv[0][0]                 │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation (Activation)       │ (None, 112, 112, 16)      │               0 │ conv_bn[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_depthwise_pad   │ (None, 113, 113, 16)      │               0 │ activation[0][0]           │
│ (ZeroPadding2D)               │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_depthwise       │ (None, 56, 56, 16)        │             144 │ expanded_conv_depthwise_p… │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_depthwise_bn    │ (None, 56, 56, 16)        │              64 │ expanded_conv_depthwise[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu (ReLU)                  │ (None, 56, 56, 16)        │               0 │ expanded_conv_depthwise_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_squeeze_excite… │ (None, 1, 1, 16)          │               0 │ re_lu[0][0]                │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_squeeze_excite… │ (None, 1, 1, 8)           │             136 │ expanded_conv_squeeze_exc… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_squeeze_excite… │ (None, 1, 1, 8)           │               0 │ expanded_conv_squeeze_exc… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_squeeze_excite… │ (None, 1, 1, 16)          │             144 │ expanded_conv_squeeze_exc… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add (Add)                     │ (None, 1, 1, 16)          │               0 │ expanded_conv_squeeze_exc… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_1 (ReLU)                │ (None, 1, 1, 16)          │               0 │ add[0][0]                  │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply (Multiply)           │ (None, 1, 1, 16)          │               0 │ re_lu_1[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_squeeze_excite… │ (None, 56, 56, 16)        │               0 │ re_lu[0][0],               │
│ (Multiply)                    │                           │                 │ multiply[0][0]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_project         │ (None, 56, 56, 16)        │             256 │ expanded_conv_squeeze_exc… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_project_bn      │ (None, 56, 56, 16)        │              64 │ expanded_conv_project[0][… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_expand        │ (None, 56, 56, 72)        │           1,152 │ expanded_conv_project_bn[… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_expand_bn     │ (None, 56, 56, 72)        │             288 │ expanded_conv_1_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_2 (ReLU)                │ (None, 56, 56, 72)        │               0 │ expanded_conv_1_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_depthwise_pad │ (None, 57, 57, 72)        │               0 │ re_lu_2[0][0]              │
│ (ZeroPadding2D)               │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_depthwise     │ (None, 28, 28, 72)        │             648 │ expanded_conv_1_depthwise… │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_depthwise_bn  │ (None, 28, 28, 72)        │             288 │ expanded_conv_1_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_3 (ReLU)                │ (None, 28, 28, 72)        │               0 │ expanded_conv_1_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_project       │ (None, 28, 28, 24)        │           1,728 │ re_lu_3[0][0]              │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_1_project_bn    │ (None, 28, 28, 24)        │              96 │ expanded_conv_1_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_expand        │ (None, 28, 28, 88)        │           2,112 │ expanded_conv_1_project_b… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_expand_bn     │ (None, 28, 28, 88)        │             352 │ expanded_conv_2_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_4 (ReLU)                │ (None, 28, 28, 88)        │               0 │ expanded_conv_2_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_depthwise     │ (None, 28, 28, 88)        │             792 │ re_lu_4[0][0]              │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_depthwise_bn  │ (None, 28, 28, 88)        │             352 │ expanded_conv_2_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_5 (ReLU)                │ (None, 28, 28, 88)        │               0 │ expanded_conv_2_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_project       │ (None, 28, 28, 24)        │           2,112 │ re_lu_5[0][0]              │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_project_bn    │ (None, 28, 28, 24)        │              96 │ expanded_conv_2_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_2_add (Add)     │ (None, 28, 28, 24)        │               0 │ expanded_conv_1_project_b… │
│                               │                           │                 │ expanded_conv_2_project_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_expand        │ (None, 28, 28, 96)        │           2,304 │ expanded_conv_2_add[0][0]  │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_expand_bn     │ (None, 28, 28, 96)        │             384 │ expanded_conv_3_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_1 (Activation)     │ (None, 28, 28, 96)        │               0 │ expanded_conv_3_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_depthwise_pad │ (None, 31, 31, 96)        │               0 │ activation_1[0][0]         │
│ (ZeroPadding2D)               │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_depthwise     │ (None, 14, 14, 96)        │           2,400 │ expanded_conv_3_depthwise… │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_depthwise_bn  │ (None, 14, 14, 96)        │             384 │ expanded_conv_3_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_2 (Activation)     │ (None, 14, 14, 96)        │               0 │ expanded_conv_3_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_squeeze_exci… │ (None, 1, 1, 96)          │               0 │ activation_2[0][0]         │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_squeeze_exci… │ (None, 1, 1, 24)          │           2,328 │ expanded_conv_3_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_squeeze_exci… │ (None, 1, 1, 24)          │               0 │ expanded_conv_3_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_squeeze_exci… │ (None, 1, 1, 96)          │           2,400 │ expanded_conv_3_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_1 (Add)                   │ (None, 1, 1, 96)          │               0 │ expanded_conv_3_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_6 (ReLU)                │ (None, 1, 1, 96)          │               0 │ add_1[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_1 (Multiply)         │ (None, 1, 1, 96)          │               0 │ re_lu_6[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_squeeze_exci… │ (None, 14, 14, 96)        │               0 │ activation_2[0][0],        │
│ (Multiply)                    │                           │                 │ multiply_1[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_project       │ (None, 14, 14, 40)        │           3,840 │ expanded_conv_3_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_3_project_bn    │ (None, 14, 14, 40)        │             160 │ expanded_conv_3_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_expand        │ (None, 14, 14, 240)       │           9,600 │ expanded_conv_3_project_b… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_expand_bn     │ (None, 14, 14, 240)       │             960 │ expanded_conv_4_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_3 (Activation)     │ (None, 14, 14, 240)       │               0 │ expanded_conv_4_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_depthwise     │ (None, 14, 14, 240)       │           6,000 │ activation_3[0][0]         │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_depthwise_bn  │ (None, 14, 14, 240)       │             960 │ expanded_conv_4_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_4 (Activation)     │ (None, 14, 14, 240)       │               0 │ expanded_conv_4_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_squeeze_exci… │ (None, 1, 1, 240)         │               0 │ activation_4[0][0]         │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_squeeze_exci… │ (None, 1, 1, 64)          │          15,424 │ expanded_conv_4_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_squeeze_exci… │ (None, 1, 1, 64)          │               0 │ expanded_conv_4_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_squeeze_exci… │ (None, 1, 1, 240)         │          15,600 │ expanded_conv_4_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_2 (Add)                   │ (None, 1, 1, 240)         │               0 │ expanded_conv_4_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_7 (ReLU)                │ (None, 1, 1, 240)         │               0 │ add_2[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_2 (Multiply)         │ (None, 1, 1, 240)         │               0 │ re_lu_7[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_squeeze_exci… │ (None, 14, 14, 240)       │               0 │ activation_4[0][0],        │
│ (Multiply)                    │                           │                 │ multiply_2[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_project       │ (None, 14, 14, 40)        │           9,600 │ expanded_conv_4_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_project_bn    │ (None, 14, 14, 40)        │             160 │ expanded_conv_4_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_4_add (Add)     │ (None, 14, 14, 40)        │               0 │ expanded_conv_3_project_b… │
│                               │                           │                 │ expanded_conv_4_project_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_expand        │ (None, 14, 14, 240)       │           9,600 │ expanded_conv_4_add[0][0]  │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_expand_bn     │ (None, 14, 14, 240)       │             960 │ expanded_conv_5_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_5 (Activation)     │ (None, 14, 14, 240)       │               0 │ expanded_conv_5_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_depthwise     │ (None, 14, 14, 240)       │           6,000 │ activation_5[0][0]         │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_depthwise_bn  │ (None, 14, 14, 240)       │             960 │ expanded_conv_5_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_6 (Activation)     │ (None, 14, 14, 240)       │               0 │ expanded_conv_5_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_squeeze_exci… │ (None, 1, 1, 240)         │               0 │ activation_6[0][0]         │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_squeeze_exci… │ (None, 1, 1, 64)          │          15,424 │ expanded_conv_5_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_squeeze_exci… │ (None, 1, 1, 64)          │               0 │ expanded_conv_5_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_squeeze_exci… │ (None, 1, 1, 240)         │          15,600 │ expanded_conv_5_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_3 (Add)                   │ (None, 1, 1, 240)         │               0 │ expanded_conv_5_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_8 (ReLU)                │ (None, 1, 1, 240)         │               0 │ add_3[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_3 (Multiply)         │ (None, 1, 1, 240)         │               0 │ re_lu_8[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_squeeze_exci… │ (None, 14, 14, 240)       │               0 │ activation_6[0][0],        │
│ (Multiply)                    │                           │                 │ multiply_3[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_project       │ (None, 14, 14, 40)        │           9,600 │ expanded_conv_5_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_project_bn    │ (None, 14, 14, 40)        │             160 │ expanded_conv_5_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_5_add (Add)     │ (None, 14, 14, 40)        │               0 │ expanded_conv_4_add[0][0], │
│                               │                           │                 │ expanded_conv_5_project_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_expand        │ (None, 14, 14, 120)       │           4,800 │ expanded_conv_5_add[0][0]  │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_expand_bn     │ (None, 14, 14, 120)       │             480 │ expanded_conv_6_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_7 (Activation)     │ (None, 14, 14, 120)       │               0 │ expanded_conv_6_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_depthwise     │ (None, 14, 14, 120)       │           3,000 │ activation_7[0][0]         │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_depthwise_bn  │ (None, 14, 14, 120)       │             480 │ expanded_conv_6_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_8 (Activation)     │ (None, 14, 14, 120)       │               0 │ expanded_conv_6_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_squeeze_exci… │ (None, 1, 1, 120)         │               0 │ activation_8[0][0]         │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_squeeze_exci… │ (None, 1, 1, 32)          │           3,872 │ expanded_conv_6_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_squeeze_exci… │ (None, 1, 1, 32)          │               0 │ expanded_conv_6_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_squeeze_exci… │ (None, 1, 1, 120)         │           3,960 │ expanded_conv_6_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_4 (Add)                   │ (None, 1, 1, 120)         │               0 │ expanded_conv_6_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_9 (ReLU)                │ (None, 1, 1, 120)         │               0 │ add_4[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_4 (Multiply)         │ (None, 1, 1, 120)         │               0 │ re_lu_9[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_squeeze_exci… │ (None, 14, 14, 120)       │               0 │ activation_8[0][0],        │
│ (Multiply)                    │                           │                 │ multiply_4[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_project       │ (None, 14, 14, 48)        │           5,760 │ expanded_conv_6_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_6_project_bn    │ (None, 14, 14, 48)        │             192 │ expanded_conv_6_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_expand        │ (None, 14, 14, 144)       │           6,912 │ expanded_conv_6_project_b… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_expand_bn     │ (None, 14, 14, 144)       │             576 │ expanded_conv_7_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_9 (Activation)     │ (None, 14, 14, 144)       │               0 │ expanded_conv_7_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_depthwise     │ (None, 14, 14, 144)       │           3,600 │ activation_9[0][0]         │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_depthwise_bn  │ (None, 14, 14, 144)       │             576 │ expanded_conv_7_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_10 (Activation)    │ (None, 14, 14, 144)       │               0 │ expanded_conv_7_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_squeeze_exci… │ (None, 1, 1, 144)         │               0 │ activation_10[0][0]        │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_squeeze_exci… │ (None, 1, 1, 40)          │           5,800 │ expanded_conv_7_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_squeeze_exci… │ (None, 1, 1, 40)          │               0 │ expanded_conv_7_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_squeeze_exci… │ (None, 1, 1, 144)         │           5,904 │ expanded_conv_7_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_5 (Add)                   │ (None, 1, 1, 144)         │               0 │ expanded_conv_7_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_10 (ReLU)               │ (None, 1, 1, 144)         │               0 │ add_5[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_5 (Multiply)         │ (None, 1, 1, 144)         │               0 │ re_lu_10[0][0]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_squeeze_exci… │ (None, 14, 14, 144)       │               0 │ activation_10[0][0],       │
│ (Multiply)                    │                           │                 │ multiply_5[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_project       │ (None, 14, 14, 48)        │           6,912 │ expanded_conv_7_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_project_bn    │ (None, 14, 14, 48)        │             192 │ expanded_conv_7_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_7_add (Add)     │ (None, 14, 14, 48)        │               0 │ expanded_conv_6_project_b… │
│                               │                           │                 │ expanded_conv_7_project_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_expand        │ (None, 14, 14, 288)       │          13,824 │ expanded_conv_7_add[0][0]  │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_expand_bn     │ (None, 14, 14, 288)       │           1,152 │ expanded_conv_8_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_11 (Activation)    │ (None, 14, 14, 288)       │               0 │ expanded_conv_8_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_depthwise_pad │ (None, 17, 17, 288)       │               0 │ activation_11[0][0]        │
│ (ZeroPadding2D)               │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_depthwise     │ (None, 7, 7, 288)         │           7,200 │ expanded_conv_8_depthwise… │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_depthwise_bn  │ (None, 7, 7, 288)         │           1,152 │ expanded_conv_8_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_12 (Activation)    │ (None, 7, 7, 288)         │               0 │ expanded_conv_8_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_squeeze_exci… │ (None, 1, 1, 288)         │               0 │ activation_12[0][0]        │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_squeeze_exci… │ (None, 1, 1, 72)          │          20,808 │ expanded_conv_8_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_squeeze_exci… │ (None, 1, 1, 72)          │               0 │ expanded_conv_8_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_squeeze_exci… │ (None, 1, 1, 288)         │          21,024 │ expanded_conv_8_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_6 (Add)                   │ (None, 1, 1, 288)         │               0 │ expanded_conv_8_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_11 (ReLU)               │ (None, 1, 1, 288)         │               0 │ add_6[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_6 (Multiply)         │ (None, 1, 1, 288)         │               0 │ re_lu_11[0][0]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_squeeze_exci… │ (None, 7, 7, 288)         │               0 │ activation_12[0][0],       │
│ (Multiply)                    │                           │                 │ multiply_6[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_project       │ (None, 7, 7, 96)          │          27,648 │ expanded_conv_8_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_8_project_bn    │ (None, 7, 7, 96)          │             384 │ expanded_conv_8_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_expand        │ (None, 7, 7, 576)         │          55,296 │ expanded_conv_8_project_b… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_expand_bn     │ (None, 7, 7, 576)         │           2,304 │ expanded_conv_9_expand[0]… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_13 (Activation)    │ (None, 7, 7, 576)         │               0 │ expanded_conv_9_expand_bn… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_depthwise     │ (None, 7, 7, 576)         │          14,400 │ activation_13[0][0]        │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_depthwise_bn  │ (None, 7, 7, 576)         │           2,304 │ expanded_conv_9_depthwise… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_14 (Activation)    │ (None, 7, 7, 576)         │               0 │ expanded_conv_9_depthwise… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_squeeze_exci… │ (None, 1, 1, 576)         │               0 │ activation_14[0][0]        │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_squeeze_exci… │ (None, 1, 1, 144)         │          83,088 │ expanded_conv_9_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_squeeze_exci… │ (None, 1, 1, 144)         │               0 │ expanded_conv_9_squeeze_e… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_squeeze_exci… │ (None, 1, 1, 576)         │          83,520 │ expanded_conv_9_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_7 (Add)                   │ (None, 1, 1, 576)         │               0 │ expanded_conv_9_squeeze_e… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_12 (ReLU)               │ (None, 1, 1, 576)         │               0 │ add_7[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_7 (Multiply)         │ (None, 1, 1, 576)         │               0 │ re_lu_12[0][0]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_squeeze_exci… │ (None, 7, 7, 576)         │               0 │ activation_14[0][0],       │
│ (Multiply)                    │                           │                 │ multiply_7[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_project       │ (None, 7, 7, 96)          │          55,296 │ expanded_conv_9_squeeze_e… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_project_bn    │ (None, 7, 7, 96)          │             384 │ expanded_conv_9_project[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_9_add (Add)     │ (None, 7, 7, 96)          │               0 │ expanded_conv_8_project_b… │
│                               │                           │                 │ expanded_conv_9_project_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_expand       │ (None, 7, 7, 576)         │          55,296 │ expanded_conv_9_add[0][0]  │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_expand_bn    │ (None, 7, 7, 576)         │           2,304 │ expanded_conv_10_expand[0… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_15 (Activation)    │ (None, 7, 7, 576)         │               0 │ expanded_conv_10_expand_b… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_depthwise    │ (None, 7, 7, 576)         │          14,400 │ activation_15[0][0]        │
│ (DepthwiseConv2D)             │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_depthwise_bn │ (None, 7, 7, 576)         │           2,304 │ expanded_conv_10_depthwis… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_16 (Activation)    │ (None, 7, 7, 576)         │               0 │ expanded_conv_10_depthwis… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_squeeze_exc… │ (None, 1, 1, 576)         │               0 │ activation_16[0][0]        │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_squeeze_exc… │ (None, 1, 1, 144)         │          83,088 │ expanded_conv_10_squeeze_… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_squeeze_exc… │ (None, 1, 1, 144)         │               0 │ expanded_conv_10_squeeze_… │
│ (ReLU)                        │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_squeeze_exc… │ (None, 1, 1, 576)         │          83,520 │ expanded_conv_10_squeeze_… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ add_8 (Add)                   │ (None, 1, 1, 576)         │               0 │ expanded_conv_10_squeeze_… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ re_lu_13 (ReLU)               │ (None, 1, 1, 576)         │               0 │ add_8[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ multiply_8 (Multiply)         │ (None, 1, 1, 576)         │               0 │ re_lu_13[0][0]             │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_squeeze_exc… │ (None, 7, 7, 576)         │               0 │ activation_16[0][0],       │
│ (Multiply)                    │                           │                 │ multiply_8[0][0]           │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_project      │ (None, 7, 7, 96)          │          55,296 │ expanded_conv_10_squeeze_… │
│ (Conv2D)                      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_project_bn   │ (None, 7, 7, 96)          │             384 │ expanded_conv_10_project[… │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ expanded_conv_10_add (Add)    │ (None, 7, 7, 96)          │               0 │ expanded_conv_9_add[0][0], │
│                               │                           │                 │ expanded_conv_10_project_… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv_1 (Conv2D)               │ (None, 7, 7, 576)         │          55,296 │ expanded_conv_10_add[0][0] │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ conv_1_bn                     │ (None, 7, 7, 576)         │           2,304 │ conv_1[0][0]               │
│ (BatchNormalization)          │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ activation_17 (Activation)    │ (None, 7, 7, 576)         │               0 │ conv_1_bn[0][0]            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ global_average_pooling2d      │ (None, 576)               │               0 │ activation_17[0][0]        │
│ (GlobalAveragePooling2D)      │                           │                 │                            │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ dense (Dense)                 │ (None, 256)               │         147,712 │ global_average_pooling2d[… │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ dropout (Dropout)             │ (None, 256)               │               0 │ dense[0][0]                │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ dense_1 (Dense)               │ (None, 128)               │          32,896 │ dropout[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ dropout_1 (Dropout)           │ (None, 128)               │               0 │ dense_1[0][0]              │
├───────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────┤
│ dense_2 (Dense)               │ (None, 5)                 │             645 │ dropout_1[0][0]            │
└───────────────────────────────┴───────────────────────────┴─────────────────┴────────────────────────────┘
 Total params: 1,120,373 (4.27 MB)
 Trainable params: 181,253 (708.02 KB)
 Non-trainable params: 939,120 (3.58 MB)
None
Step 3: Training the model with frozen base...
Epoch 1/25
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1745301171.944784   20547 service.cc:152] XLA service 0x7f452000ced0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1745301171.944828   20547 service.cc:160]   StreamExecutor device (0): NVIDIA RTX A5000, Compute Capability 8.6
2025-04-22 05:52:52.041430: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:269] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
I0000 00:00:1745301172.774819   20547 cuda_dnn.cc:529] Loaded cuDNN version 90300
2025-04-22 05:52:54.345850: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328_0', 124 bytes spill stores, 124 bytes spill loads

2025-04-22 05:52:54.545138: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 76 bytes spill stores, 76 bytes spill loads

2025-04-22 05:52:54.701436: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 636 bytes spill stores, 636 bytes spill loads

2025-04-22 05:52:54.721367: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 516 bytes spill stores, 516 bytes spill loads

2025-04-22 05:52:54.729747: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_6058', 264 bytes spill stores, 264 bytes spill loads

2025-04-22 05:52:54.894017: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 4928 bytes spill stores, 4824 bytes spill loads

2025-04-22 05:52:54.952562: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 120 bytes spill stores, 120 bytes spill loads

2025-04-22 05:52:55.073151: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_6058', 256 bytes spill stores, 256 bytes spill loads

2025-04-22 05:52:55.097694: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328_0', 1584 bytes spill stores, 1560 bytes spill loads

2025-04-22 05:52:55.119249: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_6058', 772 bytes spill stores, 1340 bytes spill loads

2025-04-22 05:52:55.334285: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 2892 bytes spill stores, 2680 bytes spill loads

I0000 00:00:1745301181.442776   20547 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
 43/154 ━━━━━━━━━━━━━━━━━━━━ 2s 22ms/step - accuracy: 0.4763 - loss: 1.28142025-04-22 05:53:04.252153: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 64 bytes spill stores, 64 bytes spill loads

2025-04-22 05:53:04.288910: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 280 bytes spill stores, 280 bytes spill loads

2025-04-22 05:53:04.645033: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 64 bytes spill stores, 64 bytes spill loads

2025-04-22 05:53:04.807292: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 5304 bytes spill stores, 5360 bytes spill loads

2025-04-22 05:53:04.899456: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 5368 bytes spill stores, 5352 bytes spill loads

2025-04-22 05:53:05.015690: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_3328', 716 bytes spill stores, 716 bytes spill loads

152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 68ms/step - accuracy: 0.6191 - loss: 0.94012025-04-22 05:53:14.074099: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361', 8 bytes spill stores, 8 bytes spill loads

2025-04-22 05:53:14.338850: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361', 104 bytes spill stores, 104 bytes spill loads

2025-04-22 05:53:14.605553: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361_0', 132 bytes spill stores, 132 bytes spill loads

2025-04-22 05:53:14.715371: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361_0', 128 bytes spill stores, 128 bytes spill loads

2025-04-22 05:53:19.858456: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 4 bytes spill stores, 4 bytes spill loads

2025-04-22 05:53:19.861308: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 16 bytes spill stores, 16 bytes spill loads

2025-04-22 05:53:19.925197: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354_0', 124 bytes spill stores, 124 bytes spill loads

2025-04-22 05:53:20.047762: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 516 bytes spill stores, 516 bytes spill loads

2025-04-22 05:53:20.048293: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 64 bytes spill stores, 64 bytes spill loads

2025-04-22 05:53:20.223329: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 900 bytes spill stores, 900 bytes spill loads

2025-04-22 05:53:20.337569: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 644 bytes spill stores, 644 bytes spill loads

2025-04-22 05:53:20.441305: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 116 bytes spill stores, 116 bytes spill loads

2025-04-22 05:53:20.563223: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361', 128 bytes spill stores, 128 bytes spill loads

2025-04-22 05:53:20.684918: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361_0', 144 bytes spill stores, 144 bytes spill loads

2025-04-22 05:53:20.736626: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354', 3336 bytes spill stores, 2844 bytes spill loads

2025-04-22 05:53:20.847774: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1354_0', 1708 bytes spill stores, 1432 bytes spill loads

2025-04-22 05:53:20.903597: I external/local_xla/xla/stream_executor/cuda/subprocess_compilation.cc:346] ptxas warning : Registers are spilled to local memory in function 'gemm_fusion_dot_1361_0', 128 bytes spill stores, 128 bytes spill loads


Epoch 1: val_accuracy improved from -inf to 0.81667, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 37s 160ms/step - accuracy: 0.6210 - loss: 0.9357 - val_accuracy: 0.8167 - val_loss: 0.4679 - learning_rate: 0.0010
Epoch 2/25
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 20ms/step - accuracy: 0.7961 - loss: 0.5245
Epoch 2: val_accuracy improved from 0.81667 to 0.83333, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 26ms/step - accuracy: 0.7962 - loss: 0.5244 - val_accuracy: 0.8333 - val_loss: 0.4299 - learning_rate: 0.0010
Epoch 3/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 19ms/step - accuracy: 0.8209 - loss: 0.4576
Epoch 3: val_accuracy improved from 0.83333 to 0.84405, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.8210 - loss: 0.4576 - val_accuracy: 0.8440 - val_loss: 0.4189 - learning_rate: 0.0010
Epoch 4/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 19ms/step - accuracy: 0.8380 - loss: 0.4297
Epoch 4: val_accuracy improved from 0.84405 to 0.84524, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 25ms/step - accuracy: 0.8380 - loss: 0.4296 - val_accuracy: 0.8452 - val_loss: 0.4091 - learning_rate: 0.0010
Epoch 5/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 19ms/step - accuracy: 0.8467 - loss: 0.4017
Epoch 5: val_accuracy improved from 0.84524 to 0.84762, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.8467 - loss: 0.4017 - val_accuracy: 0.8476 - val_loss: 0.4049 - learning_rate: 0.0010
Epoch 6/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 19ms/step - accuracy: 0.8513 - loss: 0.3834
Epoch 6: val_accuracy improved from 0.84762 to 0.85548, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.8514 - loss: 0.3834 - val_accuracy: 0.8555 - val_loss: 0.3878 - learning_rate: 0.0010
Epoch 7/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 19ms/step - accuracy: 0.8641 - loss: 0.3599
Epoch 7: val_accuracy did not improve from 0.85548
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.8640 - loss: 0.3601 - val_accuracy: 0.8460 - val_loss: 0.4099 - learning_rate: 0.0010
Epoch 8/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8622 - loss: 0.3538
Epoch 8: val_accuracy did not improve from 0.85548
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.8622 - loss: 0.3538 - val_accuracy: 0.8529 - val_loss: 0.4004 - learning_rate: 0.0010
Epoch 9/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8775 - loss: 0.3300
Epoch 9: val_accuracy improved from 0.85548 to 0.85833, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.8775 - loss: 0.3302 - val_accuracy: 0.8583 - val_loss: 0.3876 - learning_rate: 0.0010
Epoch 10/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8790 - loss: 0.3220
Epoch 10: val_accuracy did not improve from 0.85833
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.8789 - loss: 0.3221 - val_accuracy: 0.8550 - val_loss: 0.3977 - learning_rate: 0.0010
Epoch 11/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8760 - loss: 0.3155
Epoch 11: val_accuracy did not improve from 0.85833
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.8759 - loss: 0.3156 - val_accuracy: 0.8488 - val_loss: 0.4068 - learning_rate: 0.0010
Epoch 12/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8809 - loss: 0.3076
Epoch 12: val_accuracy improved from 0.85833 to 0.86000, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 

Epoch 12: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 23ms/step - accuracy: 0.8809 - loss: 0.3075 - val_accuracy: 0.8600 - val_loss: 0.3970 - learning_rate: 0.0010
Epoch 13/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.8949 - loss: 0.2720
Epoch 13: val_accuracy improved from 0.86000 to 0.86452, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.8949 - loss: 0.2720 - val_accuracy: 0.8645 - val_loss: 0.3837 - learning_rate: 5.0000e-04
Epoch 14/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9002 - loss: 0.2633
Epoch 14: val_accuracy improved from 0.86452 to 0.86619, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.9002 - loss: 0.2632 - val_accuracy: 0.8662 - val_loss: 0.3964 - learning_rate: 5.0000e-04
Epoch 15/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9048 - loss: 0.2467
Epoch 15: val_accuracy did not improve from 0.86619
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.9048 - loss: 0.2469 - val_accuracy: 0.8586 - val_loss: 0.3954 - learning_rate: 5.0000e-04
Epoch 16/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9097 - loss: 0.2398
Epoch 16: val_accuracy improved from 0.86619 to 0.86857, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 

Epoch 16: ReduceLROnPlateau reducing learning rate to 0.0002500000118743628.
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 23ms/step - accuracy: 0.9097 - loss: 0.2398 - val_accuracy: 0.8686 - val_loss: 0.3841 - learning_rate: 5.0000e-04
Epoch 17/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9159 - loss: 0.2157
Epoch 17: val_accuracy did not improve from 0.86857
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.9159 - loss: 0.2157 - val_accuracy: 0.8676 - val_loss: 0.4026 - learning_rate: 2.5000e-04
Epoch 18/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9196 - loss: 0.2128
Epoch 18: val_accuracy did not improve from 0.86857
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.9196 - loss: 0.2129 - val_accuracy: 0.8662 - val_loss: 0.3950 - learning_rate: 2.5000e-04
Epoch 19/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9230 - loss: 0.2079
Epoch 19: val_accuracy did not improve from 0.86857

Epoch 19: ReduceLROnPlateau reducing learning rate to 0.0001250000059371814.
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.9230 - loss: 0.2080 - val_accuracy: 0.8679 - val_loss: 0.3987 - learning_rate: 2.5000e-04
Epoch 20/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9207 - loss: 0.2071
Epoch 20: val_accuracy improved from 0.86857 to 0.87095, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 4s 24ms/step - accuracy: 0.9208 - loss: 0.2069 - val_accuracy: 0.8710 - val_loss: 0.4067 - learning_rate: 1.2500e-04
Epoch 21/25
152/154 ━━━━━━━━━━━━━━━━━━━━ 0s 18ms/step - accuracy: 0.9255 - loss: 0.1994
Epoch 21: val_accuracy did not improve from 0.87095
154/154 ━━━━━━━━━━━━━━━━━━━━ 3s 22ms/step - accuracy: 0.9256 - loss: 0.1993 - val_accuracy: 0.8688 - val_loss: 0.4091 - learning_rate: 1.2500e-04
Epoch 21: early stopping
Restoring model weights from the end of the best epoch: 13.
Step 4: Evaluating the initial model...
33/33 ━━━━━━━━━━━━━━━━━━━━ 14s 337ms/step
2025-04-22 05:54:54.308833: I tensorflow/core/framework/local_rendezvous.cc:407] Local rendezvous is aborting with status: OUT_OF_RANGE: End of sequence

Classification Report:
              precision    recall  f1-score   support

     Drawing       0.80      0.83      0.81       840
      Hentai       0.88      0.81      0.84       840
     Neutral       0.86      0.91      0.88       840
        Porn       0.93      0.91      0.92       840
        Sexy       0.89      0.90      0.89       840

    accuracy                           0.87      4200
   macro avg       0.87      0.87      0.87      4200
weighted avg       0.87      0.87      0.87      4200

Overall accuracy: 0.8695
Step 5: Fine-tuning the model with discriminative learning rates...

Adjusted class weights for fine-tuning:
{np.int64(1): 1.0, np.int64(2): 1.0, np.int64(0): 1.0, np.int64(4): 1.0, np.int64(3): 1.0}

Discriminative Learning Rate Structure:
Group 1 (50 layers): Learning rate = 0.000050
Group 2 (40 layers): Learning rate = 0.000100
Group 3 (67 layers): Learning rate = 0.000200
Group 4 (6 layers): Learning rate = 0.000400
Epoch 1/30
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 169ms/step - accuracy: 0.6579 - loss: 1.2099   
Epoch 1: val_accuracy improved from -inf to 0.74952, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 67s 215ms/step - accuracy: 0.6587 - loss: 1.2065 - val_accuracy: 0.7495 - val_loss: 0.8026 - learning_rate: 5.0000e-05
Epoch 2/30
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.8775 - loss: 0.3355  
Epoch 2: val_accuracy improved from 0.74952 to 0.79000, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 52ms/step - accuracy: 0.8775 - loss: 0.3354 - val_accuracy: 0.7900 - val_loss: 0.6634 - learning_rate: 5.0000e-05
Epoch 3/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.8914 - loss: 0.2850
Epoch 3: val_accuracy improved from 0.79000 to 0.80119, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 

Epoch 3: Learning rates updated:
Group 1: 0.000045
Group 2: 0.000090
Group 3: 0.000180
Group 4: 0.000360
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.8914 - loss: 0.2849 - val_accuracy: 0.8012 - val_loss: 0.6381 - learning_rate: 5.0000e-05
Epoch 4/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9074 - loss: 0.2455
Epoch 4: val_accuracy improved from 0.80119 to 0.82714, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9074 - loss: 0.2455 - val_accuracy: 0.8271 - val_loss: 0.5497 - learning_rate: 5.0000e-05
Epoch 5/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9206 - loss: 0.2151
Epoch 5: val_accuracy improved from 0.82714 to 0.84595, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9206 - loss: 0.2152 - val_accuracy: 0.8460 - val_loss: 0.4811 - learning_rate: 5.0000e-05
Epoch 6/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9286 - loss: 0.1908
Epoch 6: val_accuracy improved from 0.84595 to 0.86286, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 

Epoch 6: Learning rates updated:
Group 1: 0.000041
Group 2: 0.000081
Group 3: 0.000162
Group 4: 0.000324
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9286 - loss: 0.1909 - val_accuracy: 0.8629 - val_loss: 0.4224 - learning_rate: 5.0000e-05
Epoch 7/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9352 - loss: 0.1763
Epoch 7: val_accuracy improved from 0.86286 to 0.86619, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 52ms/step - accuracy: 0.9352 - loss: 0.1763 - val_accuracy: 0.8662 - val_loss: 0.4128 - learning_rate: 5.0000e-05
Epoch 8/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9437 - loss: 0.1564
Epoch 8: val_accuracy improved from 0.86619 to 0.87214, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 52ms/step - accuracy: 0.9437 - loss: 0.1564 - val_accuracy: 0.8721 - val_loss: 0.3954 - learning_rate: 5.0000e-05
Epoch 9/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9474 - loss: 0.1412
Epoch 9: val_accuracy improved from 0.87214 to 0.87976, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 

Epoch 9: Learning rates updated:
Group 1: 0.000036
Group 2: 0.000073
Group 3: 0.000146
Group 4: 0.000292
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 52ms/step - accuracy: 0.9474 - loss: 0.1413 - val_accuracy: 0.8798 - val_loss: 0.3793 - learning_rate: 5.0000e-05
Epoch 10/30
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9538 - loss: 0.1257
Epoch 10: val_accuracy improved from 0.87976 to 0.88571, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 53ms/step - accuracy: 0.9538 - loss: 0.1258 - val_accuracy: 0.8857 - val_loss: 0.3626 - learning_rate: 5.0000e-05
Epoch 11/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9600 - loss: 0.1140
Epoch 11: val_accuracy improved from 0.88571 to 0.88714, saving model to mobilenetv3_nsfw_model_best.h5
WARNING:absl:You are saving your model as an HDF5 file via `model.save()` or `keras.saving.save_model(model)`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')` or `keras.saving.save_model(model, 'my_model.keras')`. 
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 52ms/step - accuracy: 0.9599 - loss: 0.1140 - val_accuracy: 0.8871 - val_loss: 0.3722 - learning_rate: 5.0000e-05
Epoch 12/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 45ms/step - accuracy: 0.9660 - loss: 0.0992
Epoch 12: val_accuracy did not improve from 0.88714

Epoch 12: Learning rates updated:
Group 1: 0.000033
Group 2: 0.000066
Group 3: 0.000131
Group 4: 0.000262
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 49ms/step - accuracy: 0.9660 - loss: 0.0993 - val_accuracy: 0.8864 - val_loss: 0.3716 - learning_rate: 5.0000e-05
Epoch 13/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9671 - loss: 0.0908
Epoch 13: val_accuracy did not improve from 0.88714

Epoch 13: ReduceLROnPlateau reducing learning rate to 2.499999936844688e-05.
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 50ms/step - accuracy: 0.9671 - loss: 0.0908 - val_accuracy: 0.8862 - val_loss: 0.3887 - learning_rate: 5.0000e-05
Epoch 14/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9707 - loss: 0.0792
Epoch 14: val_accuracy did not improve from 0.88714
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 50ms/step - accuracy: 0.9707 - loss: 0.0792 - val_accuracy: 0.8852 - val_loss: 0.3890 - learning_rate: 2.5000e-05
Epoch 15/30
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 47ms/step - accuracy: 0.9742 - loss: 0.0737
Epoch 15: val_accuracy did not improve from 0.88714

Epoch 15: Learning rates updated:
Group 1: 0.000030
Group 2: 0.000059
Group 3: 0.000118
Group 4: 0.000236
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9742 - loss: 0.0737 - val_accuracy: 0.8855 - val_loss: 0.3942 - learning_rate: 2.5000e-05
Epoch 16/30
154/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9796 - loss: 0.0628
Epoch 16: val_accuracy did not improve from 0.88714

Epoch 16: ReduceLROnPlateau reducing learning rate to 1.249999968422344e-05.
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9796 - loss: 0.0628 - val_accuracy: 0.8869 - val_loss: 0.4048 - learning_rate: 2.5000e-05
Epoch 17/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 46ms/step - accuracy: 0.9785 - loss: 0.0644
Epoch 17: val_accuracy did not improve from 0.88714
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 50ms/step - accuracy: 0.9785 - loss: 0.0644 - val_accuracy: 0.8871 - val_loss: 0.4056 - learning_rate: 1.2500e-05
Epoch 18/30
153/154 ━━━━━━━━━━━━━━━━━━━━ 0s 47ms/step - accuracy: 0.9812 - loss: 0.0598
Epoch 18: val_accuracy did not improve from 0.88714

Epoch 18: Learning rates updated:
Group 1: 0.000027
Group 2: 0.000053
Group 3: 0.000106
Group 4: 0.000213
154/154 ━━━━━━━━━━━━━━━━━━━━ 8s 51ms/step - accuracy: 0.9812 - loss: 0.0598 - val_accuracy: 0.8860 - val_loss: 0.4104 - learning_rate: 1.2500e-05
Epoch 18: early stopping
Restoring model weights from the end of the best epoch: 10.
Step 6: Evaluating the fine-tuned model...
33/33 ━━━━━━━━━━━━━━━━━━━━ 7s 131ms/step

Classification Report:
              precision    recall  f1-score   support

     Drawing       0.84      0.80      0.82       840
      Hentai       0.83      0.90      0.87       840
     Neutral       0.91      0.87      0.89       840
        Porn       0.94      0.95      0.94       840
        Sexy       0.92      0.92      0.92       840

    accuracy                           0.89      4200
   macro avg       0.89      0.89      0.89      4200
weighted avg       0.89      0.89      0.89      4200

Overall accuracy: 0.8874
Step 7: Comparing models and selecting the best...

Model Comparison:
Base Model Accuracy: 0.8695
Fine-tuned Model Accuracy: 0.8874
Absolute Improvement: 0.0179 (1.79%)
The fine-tuned model performs better!
Best model saved at: mobilenetv3_nsfw_model_finetuned_best.h5

Per-class improvement:
Drawing: -2.86% ↓
Hentai: 8.93% ↑
Neutral: -3.45% ↓
Porn: 4.05% ↑
Sexy: 2.26% ↑
NSFW content classification model development completed! Best model: mobilenetv3_nsfw_model_finetuned_best.h5
(tf217) root@16DCEB107-GIS1:~/projects/tf217/codes_sun_train+finetuning_but_with_all_layers_unlocked_during_finetuing# 